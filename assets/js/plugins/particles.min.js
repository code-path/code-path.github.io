var ctx=canvas.getContext("2d");var settings={lineLength:50,speed:1,lifeTime:1500,maxParticles:200,radius:.5,avoidVisited:true,clearTrails:function(){ctx.clearRect(0,0,width,height);visited=[]},restart:function(){ctx.clearRect(0,0,width,height);particles=[];visited=[]}};var visited=[];function onResize(){width=canvas.width=window.innerWidth;height=canvas.height=window.innerHeight}function rotate(vec,angle){angle=angle*Math.PI/180;return[vec[0]*Math.cos(angle)-vec[1]*Math.sin(angle),vec[0]*Math.sin(angle)+vec[1]*Math.cos(angle)]}var dirVecs=[[1,0],rotate([1,0],120),rotate([1,0],240)];var particles=[];function isVisited(x,y){var pos=[Math.floor(x),Math.floor(y)];for(var i=0;i<visited.length;i++){if(visited[i][0]==pos[0]&&visited[i][1]==pos[1]){return true}}return false}function addToVisited(x,y){if(!isVisited(x,y)){var pos=[Math.floor(x),Math.floor(y)];visited.push(pos)}}function particle(){this.x=0;this.y=0;this.age=0;this.dir=dirVecs[Math.floor(Math.random()*3)];this.color="hsl("+Date.now()/100%360+", 90%, light%)"}particle.prototype.updateAndDraw=function(){this.age+=1;if(this.age%settings.lineLength==0){var dir1=rotate(this.dir,60);var dir2=rotate(this.dir,-60);var options=[];if(settings.avoidVisited){if(!isVisited(this.x+dir1[0]*settings.lineLength,this.y+dir1[1]*settings.lineLength)){options.push(dir1)}if(!isVisited(this.x+dir2[0]*settings.lineLength,this.y+dir2[1]*settings.lineLength)){options.push(dir2)}if(options.length==0){options=[dir1,dir2]}}else{options=[dir1,dir2]}this.dir=options[Math.floor(Math.random()*options.length)];addToVisited(this.x,this.y)}ctx.fillStyle=this.color.replace("light","70");ctx.beginPath();ctx.arc(width/2+this.x,height/2+this.y,settings.radius,0,6.3);ctx.shadowBlur=settings.radius*6;ctx.shadowColor=this.color.replace("light","30");ctx.fill();this.x+=this.dir[0]*settings.speed;this.y+=this.dir[1]*settings.speed};function updateAndDraw(){ctx.shadowBlur=0;ctx.globalCompositeOperation="source-over";ctx.fillStyle="rgba(0, 0, 0, 0.03)";ctx.fillRect(0,0,width,height);ctx.globalCompositeOperation="lighter";for(var i=particles.length-1;i>=0;i--){particles[i].updateAndDraw();if(particles[i].age>settings.lifeTime){particles.splice(i,1)}}if(particles.length<settings.maxParticles){if(Math.random()>.9){particles.push(new particle)}}else if(particles.length>settings.maxParticles){particles.splice(0,settings.maxParticles)}requestAnimationFrame(updateAndDraw)}function particlesInit(){onResize();window.onresize=onResize;updateAndDraw()}